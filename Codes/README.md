# عنوان پروژه
**تولید خودکار موسیقی احساسی با سبک‌های جهانی و ایرانی (Global/Persian)**

**دانشگاه/دانشکده:** مهندسی کامپیوتر - دانشگاه اصفهان

**نام دانشجو:** محمد امین کیانی  
**استاد راهنما:** دکتر حسین ماهوش محمدی  
**تاریخ:** 1404/06/20  
**نسخه/Commit مرجع کد:** -

---

## چکیده
> در ۱۵۰–۲۵۰ کلمه: مسأله، رویکرد، پیاده‌سازی، نتایج کلیدی، کاربردها.  
**کلمات کلیدی:** Music Generation, Emotion, Persian Instruments, General MIDI, MER, PrettyMIDI, SoundFont

---

## فهرست مطالب
1. مقدمه و مسئله تحقیق  
2. کارهای مرتبط و پیشینه  
3. مبانی نظری و واژه‌نامه  
4. روش پیشنهادی (System Overview)  
5. طراحی و پیاده‌سازی  
6. تنظیمات و پارامترها  
7. ارزیابی و سنجه‌ها  
8. نتایج تجربی  
9. بحث و تحلیل  
10. محدودیت‌ها و کارهای آینده  
11. ملاحظات اخلاقی/فرهنگی  
12. راهنمای نصب و اجرا  
13. ساختار مخزن کد  
14. پیوست‌ها

---

## 1) مقدمه و مسئله تحقیق
**انگیزه/نیاز:** ☐ چرا به تولید موسیقی احساسی نیاز داریم؟ کاربردها (بازی، فیلم، مدیتیشن، دستیارهای هوشمند…).  
**مسئله:** ☐ تبدیل ورودی (متن/تصویر/صوت) به موسیقی با احساس هدف و دو سبک «global» و «persian».  
**سهم/نوآوری:** ☐ نگاشت سازهای ایرانی به GM، طرح‌وارهٔ A–B–A′، ارزیابی ساختاری+شنیداری، پروفایل‌های احساسی.  
**خروجی‌ها:** ☐ فایل‌های MIDI/WAV/MP3 + گزارش ارزیابی.  
**خلاصه نتایج:** ☐ یک یا دو عدد/مشاهدهٔ کلیدی.

---

## 2) کارهای مرتبط و پیشینه
**دو حوزهٔ اصلی:** (الف) تشخیص احساس از سیگنال/متن (MER)، (ب) تولید خودکار موسیقی (Algorithmic Composition).  
**منابع شاخص:** ☐ چند نمونه (RNN/Transformer/Markov/Rule-based).  
**جایگاه کار شما:** ☐ تأکید بر سبک ایرانی و ارزیابی دوبخشی (ساختاری+شنیداری).

---

## 3) مبانی نظری و واژه‌نامه
### 3.1 مفاهیم موسیقی پایه
- **گام/کلید (Key):** نت مرجع و مجموعهٔ فواصل.  
- **ماژور/مینور (Mode):** شکل فواصل (شاد/غیر).  
- **BPM/Tempo:** ضرب‌در دقیقه؛ سرعت.  
- **میزان/بار (Bar) و ضرب (Beat):** واحدهای زمانی.  
- **آکورد (Chord) و پروگرشن:** هم‌نوا و توالی آکوردها؛ مثال I–vi–IV–V.  
- **درجه‌های رومی:** I…VII در ماژور، i…vii° در مینور.  
- **فرم A–B–A′:** معرفی، تقابل، بازگشت با تغییر.  
- **مدولاسیون (Modulation):** تغییر کلید/نت مرجع.  
- **سنکوپ (Syncopation):** تاکید ریتمیک خارج از ضرب قوی.  
- **دیسونانس (Dissonance):** کشمکش صوتی/هارمونیک.  
- **چگالی (Density):** تعداد نُت‌ها در واحد زمان/میزان.  

### 3.2 General MIDI (GM) و نگاشت سازهای ایرانی
- **GM:** استاندارد شمارهٔ سازها (۰–۱۲۷).  
- **نگاشت:** Santur≈Dulcimer(15), Tar≈NylonGtr/Sitar/Koto, Ney≈Shakuhachi/PanFlute…  
- **محدودیت:** ربع‌پرده‌ها پوشش مستقیم ندارند؛ مقیاس‌های تقریبی (Hijaz, Nahawand, Saba-like…).

---

## 4) روش پیشنهادی (System Overview)
**جریان کلی:**  
ورودی (متن/تصویر/صوت) → تشخیص احساس → انتخاب پروفایل احساسی (EMO_PROFILE) → تعیین BPM/Mode/Key/Progression → تولید MIDI (بخش‌های A–B–A′) → رندر WAV/MP3 با SoundFont → ارزیابی ساختاری + ارزیابی شنیداری → گزارش.

**بلوک‌ها:**  
- تشخیص احساس: `analyze_all` → برچسب + اطمینان.  
- تولید: `generate_full_track` (نقش‌ها، الگوهای آکورد/آرپژ/باس/درام).  
- ارزیابی: `analyze_midi_struct` و `evaluate_with_audio_classifier`.  
- UI: `analyze_and_make_music` (Gradio).

**ساختار موسیقی:** A–B–A′ با تغییرات چگالی/کلید/پروگرشن در B.

---

## 5) طراحی و پیاده‌سازی
### 5.1 ماژول‌ها و داده‌های پیکربندی
- `EMO_PROFILE`: مد، بازهٔ تمپو، کلیدهای پایه، پروگرشن‌های منتخب، چگالی ملودی، درام.  
- `GM` و `PERSIAN_GM`: مجموعهٔ برنامه‌های GM و نگاشت سازهای ایرانی.  
- `PERSIAN_ROLES`: انتخاب نقش سازها برحسب احساس.

### 5.2 تولید هارمونی و خطوط سازها
- توابع هارمونی: `_add_chord`, `_arp_pattern`, `_bass_pattern`.  
- ملودی هد: `_lead_melody` با الگوی موتیف و کنترل چگالی.  
- مقیاس‌ها: `_scale_for(mode, emotion, style)` (تقریب دستگاه‌ها بدون ربع‌پرده).  
- همراهی ایرانی: `_add_persian_bed`, الگوهای نی/کمانچه/سنتور.  
- درام‌ها: `_drum_bar`, `_dance_4onfloor`, `_metal_bar`, `_persian_68`.

### 5.3 ساختاردهی قطعه
- تابع `render_section`: رندر هر بخش بر اساس رومن-نومرال و ROM (MAJOR/MINOR).  
- فرم A–B–A′ با امکان مدولاسیون جزئی (`mod_key = key ± 2`).

### 5.4 رندر صوتی و خروجی
- ایجاد MIDI با PrettyMIDI → رندر WAV با SoundFont (FluidR3_GM.sf2) → MP3.  
- نام‌گذاری خروجی‌ها شامل زمان/پارامترها.

---

## 6) تنظیمات و پارامترها (Hyperparameters)
- **EMO_PROFILE:**  
  - HAPPY: Major, 124–142 BPM, پروگرشن‌های شاد، درام فعال.  
  - SAD: Minor, 45–60 BPM, چگالی کم، بدون درام.  
  - ANGRY: Minor, 150–175 BPM, گیتار درایو، درام متال.  
  - FEAR: Minor, 50–68 BPM, ارگان طولانی/بستر دلهره‌آور.  
  - SURPRISE: Major, 122–145 BPM, سنکوپ، درام نیم‌سوئینگ.  
  - OTHER: Major, 90–110 BPM.
- **ROM جداول رومن-نومرال:** MAJOR/MINOR به فواصل (maj/min/dim).  
- **SoundFont:** مسیر و شیوهٔ جایگزینی.

---

## 7) ارزیابی و سنجه‌ها
### 7.1 ارزیابی ساختاری (بدون گوش)
- **Mode Match** (۰/۱): تطابق مد تولید با هدف.  
- **Tempo Fit** (۰/۱): تمپو در بازهٔ هدف.  
- **Density Fit** (۰–۱): نزدیکی چگالی نُت به بازهٔ هدف.  
- **Dissonance Fit** (۰/۰.۵/۱): وجود الگوهای تنش/کاهش تنش.  
- **Syncopation Fit** (۰–۱): میزان سنکوپ متناسب با هدف.  
- **Overall Structural Score**: میانگین وزنی.

### 7.2 ارزیابی شنیداری (با گوش ماشینی)
- **Audio Classifier:** پیش‌بینی احساس از WAV → مقایسه با هدف.  
- **Audio Match** (۰/۱) و **Final Score** = ۰.۷۵×ساختاری + ۰.۲۵×شنیداری.

---

## 8) نتایج تجربی
> جدول نمونه‌ها (احساس/سبک، BPM، Bars، Density/Score، پیش‌بینی صوتی…).  
> نمودار/هیستوگرام چگالی یا سنکوپ (اختیاری).  
**مشاهدات کیفی:** ☐ (نمونه‌های FEAR در سبک Persian/Global، تفاوت حس، نقش ارگان/نی…).

---

## 9) بحث و تحلیل
- نقاط قوت روش (کنترل‌پذیری، سادگی، تفسیرپذیری).  
- نقاط ضعف (ربع‌پرده واقعی، تعمیم سبک‌ها، دقت طبقه‌بند صوتی).  
- ارتباط نتایج با اهداف اولیه.

---

## 10) محدودیت‌ها و کارهای آینده
- پشتیبانی از ربع‌پرده/کُماها، SoundFont ایرانی، کنترل دینامیک پیشرفته.  
- یادگیری پروگرشن‌ها از دیتاست‌ها، شخصی‌سازی احساس، بهبود طبقه‌بند صوت.

---

## 11) ملاحظات اخلاقی/فرهنگی
- احترام به هویت موسیقی ایرانی، اصالت سازها، مجوز SoundFont/کُد.  
- عدم القای احساسات نامطلوب در کاربردهای حساس.

---

## 12) راهنمای نصب و اجرا (User Guide)
- **پیش‌نیازها:** Python نسخه ☐، بسته‌ها (pretty_midi, numpy, soundfile, gradio, …).  
- **SoundFont:** مسیر `FluidR3_GM.sf2` یا آپلود سفارشی.  
- **اجرای خط فرمان/نوت‌بوک:** نمونهٔ دستور و پارامترها.  
- **خروجی‌ها:** مسیر فایل‌های MIDI/WAV/MP3 و گزارش JSON.

---

## 13) ساختار مخزن کد (Repository Structure)
```
project-root/
  ├─ src/ (ماژول‌های تولید و ارزیابی)
  ├─ ui/  (Gradio)
  ├─ assets/ (SoundFont/نمونه‌ها)
  ├─ results/ (خروجی‌ها و گزارش‌ها)
  └─ README.md
```
**فایل‌های کلیدی:** ☐ `generate_full_track.py`, `analysis.py`, `ui_app.py`, …

---

## 14) پیوست‌ها
**پیوست A – واژه‌نامهٔ تکمیلی:** تعریف دقیق اصطلاحات (BPM, Mode, Progression, Modulation, Syncopation, Dissonance, Density, GM…).  
**پیوست B – جداول سازها (GM/Persian GM):** نگاشت عددی برنامه‌ها.  
**پیوست C – فرمول‌ها/شبه‌کد:** محاسبهٔ سنکوپ/چگالی/امتیاز.  
**پیوست D – نمونهٔ خروجی‌ها:** اسکرین‌شات/لینک فایل‌های صوتی.

---

### چک‌لیست دفاع ۱۰–۱۵ دقیقه‌ای
1) مسئله و انگیزه (۱ دقیقه)  
2) روش و معماری (۳ دقیقه)  
3) دموی کوتاه (۲ دقیقه)  
4) ارزیابی و نتایج (۳ دقیقه)  
5) جمع‌بندی و آینده (۱ دقیقه)  
6) پاسخ به پرسش‌ها

> **راهنما برای تکمیل:** برای هر بخش بالایی، نکات گلوله‌ای خودتان را بفرستید تا همان بخش را کامل و نهایی کنیم (رسم نمودار/جدول هم در صورت نیاز افزوده می‌شود).

